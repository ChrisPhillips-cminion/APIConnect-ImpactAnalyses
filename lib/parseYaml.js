"use strict";function parseYaml(e,i){var o,r,n=null,a=yaml.safeLoad(fs.readFileSync(e,"utf8")),t=a.info["x-ibm-name"],s=a.info.title,u=a.info.version,f={apis:void 0,products:{}};if(void 0==a.apis&&(a.apis={}),a.product)return f.products={name:a.info.name,title:a.info.title,version:a.info.version,plans:a.plans,apis:a.apis},i(n,f);if(r={apiname:t,version:u,title:s,service:[],qm:[]},f.apis=r,!a["x-ibm-configuration"].assembly)return i(n,f);o=a["x-ibm-configuration"].assembly.execute;try{o.forEachThen(function(e){evaluateInvokes(o,f,e)},i)}catch(v){throw n=v,console.error(v),v}finally{return config.debug&&console.error("ParseYAML.js returns: "+JSON.stringify(f,{},2)),i(n,f)}}function evaluateInvokes(e,i,o){"object"!=typeof e?o():e.forEachThen(function(o,r){var n=void 0;if(e[r]?n=e[r]:r&&(n=r),n&&void 0!==n.mqinvoke){var a={queuemanager:n.mqinvoke.queuemanager,requestqueue:n.mqinvoke.queue,replyqueue:n.mqinvoke.replyqueue,backoutqueue:n.mqinvoke.backoutq};i.apis.qm.push(a)}if(n&&void 0!==n.invoke){var t=n.invoke["target-url"];/^(?:f|ht)tps?\:\/\//.test(t)||(t="http://"+t),console.log(t),i.apis.service.push(t)}n&&void 0!==n.proxy&&(t=n.proxy["target-url"],/^(?:f|ht)tps?\:\/\//.test(t)||(t="http://"+t),i.apis.service.push(t)),evaluateInvokes(n,i,o)},o)}var fs=require("fs"),yaml=require("js-yaml"),config=require("./config.js");module.exports=parseYaml;